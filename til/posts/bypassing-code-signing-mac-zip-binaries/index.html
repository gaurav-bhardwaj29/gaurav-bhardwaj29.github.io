<!DOCTYPE html>
<html>
<head>
   <meta name="fediverse:creator" content="@wiredguy@mastodon.social">                  
  <link rel="stylesheet" href="../../til-style.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/themes/prism.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
  <script defer src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/prism.min.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>
  <script>
    document.addEventListener("DOMContentLoaded", function() {
      if (window.renderMathInElement) {
        renderMathInElement(document.body, {
          delimiters: [
            {left: '$$', right: '$$', display: true},
            {left: '$', right: '$', display: false}
          ]
        });
      }
    });
  </script>
  <title>Bypassing macOS code signing for ZIP-appended binaries</title>
</head>
<body>
<main>
  <h1>Bypassing macOS code signing for ZIP-appended binaries</h1>
  <div class="til-actions">
    <button class="share-btn" id="share-btn" title="Share this TIL">
      <svg class="share-icon" viewBox="0 0 24 24" fill="none" stroke="#555" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <circle cx="18" cy="5" r="3" />
        <circle cx="6" cy="12" r="3" />
        <circle cx="18" cy="19" r="3" />
        <line x1="8.59" y1="13.51" x2="15.42" y2="17.49" />
        <line x1="15.41" y1="6.51" x2="8.59" y2="10.49" />
      </svg>
    </button>
  </div>
  <div class="til-body"><p>I wanted to append a zip data to the end of a binary executable in C to create a single executable server that reads its own zip tail on launch. </p>
<p>Doing this directly on my mac M2 via <code>cat repl site.zip &gt; repl.app</code>  and <code>chmod +x repl.app</code> returned a corrupted file which did not run. </p>
<p>Apparently macOS kills Mach-O binaries with appended data due to <a href="https://developer.apple.com/documentation/security/notarizing-macos-software-before-distribution">some code signing &amp; notarization rules</a>. </p>
<p>There is a possible <a href="https://stackoverflow.com/questions/1604673/how-do-i-embed-data-into-a-mac-os-x-mach-o-binary-files-text-section/1605237">workaround solution</a> that looks like it should work, instead I tried a simpler approach by creating a ‘polyglot file’ (a techie jargon for header files) which is part shell script and part binary. Claude helped me with this. Now doing <code>cat header.sh repl site.zip &gt; repl.app</code>  works with a little catch: I have to calculate (#bytes in repl - #bytes in site.zip) and update the header.sh dynamically when either of the two files change.</p>

  <!-- Perlin noise image row (only for the perlin-noise post) -->
  
    <!-- simplex noise image row (only for the simplex-noise post) -->
  
  </div>
  <div class="til-date">Posted on 02 July 2025 (IST) · Follow me on <a href="https://x.com/wiredguys">Twitter</a> or <a rel="me" href="https://mastodon.social/@wiredguy">Mastodon</a></div>

  <ul class="til-list">
    <li><a href="../../index.html">&laquo; TIL</a></li>
  </ul>
  <div class="til-sidebar">
    <h5>Jump to</h5>
    <ul>
      <li><a href="../tls-handshakes/">Next: Integrating TLS via mbedTLS in web server &rarr;</a></li>
      <li><a href="../hosting-gcp/">&larr; Previous: Hosting website as a subdomain on Google Cloud</a></li>
    </ul>
  </div>
  <script>
    const shareBtn = document.getElementById('share-btn');
    shareBtn.addEventListener('click', function() {
      if (navigator.share) {
        navigator.share({
          title: document.title,
          url: window.location.href
        });
      } else {
        navigator.clipboard.writeText(window.location.href);
        shareBtn.classList.add('shared');
        shareBtn.title = 'Copied!';
        setTimeout(() => { shareBtn.classList.remove('shared'); shareBtn.title = 'Share this TIL'; }, 1200);
      }
    });
  </script>
</main>
</body>
</html>
