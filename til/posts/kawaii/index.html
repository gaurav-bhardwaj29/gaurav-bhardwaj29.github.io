<!DOCTYPE html>
<html>
<head>
   <meta name="fediverse:creator" content="@wiredguy@mastodon.social">                  
  <link rel="stylesheet" href="../../til-style.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/themes/prism.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
  <script defer src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/prism.min.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>
  <script src="https://challenges.cloudflare.com/turnstile/v0/api.js" async defer></script>
  <script>
    document.addEventListener("DOMContentLoaded", function() {
      if (window.renderMathInElement) {
        renderMathInElement(document.body, {
          delimiters: [
            {left: '$$', right: '$$', display: true},
            {left: '$', right: '$', display: false}
          ]
        });
      }
    });
  </script>
  <title>Custom browser picker on macOS with finicky</title>
  <style>
    .upvote-btn {
      display: inline-flex;
      align-items: center;
      cursor: pointer;
      border: none;
      background: none;
      padding: 0.2em 0.4em;
      margin-left: 0.5em;
      transition: color 0.2s, transform 0.1s;
      color: #aaa;
      font-size: 1.5em;
      outline: none;
    }
    .upvote-btn:active {
      transform: scale(1.18);
    }
    .upvote-btn.upvoted {
      color: #4b4e50;
      font-weight: bold;
      /* transform: scale(1.2); -- handled by JS for pop effect */
    }
    .upvote-arrow {
      width: 1.2em;
      height: 1.2em;
      display: inline-block;
      vertical-align: middle;
      transition: stroke 0.18s, fill 0.18s;
      fill: #d1d1d1;
      stroke: #7d8082;
    }
    .upvote-btn.upvoted .upvote-arrow {
      stroke: #4b4e50;
      fill: #4b4e50;
    }
    .upvote-btn.pop {
      animation: upvote-pop 0.18s cubic-bezier(.4,1.6,.6,1) 1;
    }
    @keyframes upvote-pop {
      0% { transform: scale(1); }
      60% { transform: scale(1.28); }
      100% { transform: scale(1); }
    }
    /* ...existing code... */
  </style>
</head>
<body>
<main>
  <h1>Custom browser picker on macOS with finicky</h1>
  <div class="til-actions">
    <button class="upvote-btn" id="upvote-btn" title="Upvote this TIL" aria-pressed="false">
      <svg class="upvote-arrow" viewBox="0 0 24 24" fill="#d1d1d1" stroke="#7d8082" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <polygon points="12,4 19,20 5,20" />
      </svg>
    </button>
    <button class="share-btn" id="share-btn" title="Share this TIL">
      <svg class="share-icon" viewBox="0 0 24 24" fill="none" stroke="#555" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <circle cx="18" cy="5" r="3" />
        <circle cx="6" cy="12" r="3" />
        <circle cx="18" cy="19" r="3" />
        <line x1="8.59" y1="13.51" x2="15.42" y2="17.49" />
        <line x1="15.41" y1="6.51" x2="8.59" y2="10.49" />
      </svg>
    </button>
  </div>
  <div class="til-body"><p>Many apps and links on macOS simply open in whatever browser is set as the default or last active, without offering a choice each time. By default, macOS uses the single system default browser (set in System Preferences/Settings) and does not prompt per-link. This means you might end up opening links repeatedly in the same browser even when you want to choose a different one.
I created a <strong>custom browser picker pop-up (aka kawaii)</strong> using <a href="https://github.com/johnste/finicky">Finicky</a>. This allows me to <strong>intercept link clicks</strong> and choose between browsers like Safari, Chrome, Firefox, and Brave — and even choose which browser profile to use — all from a native-looking UI.</p>
<hr />
<h2>kawaii UI</h2>
<figure style="text-align: center;">
  <img src="https://pub-91e1a485198740aabff1705e89606dc3.r2.dev/kawaii-ui.png" style="max-width: 100%; height: auto;" />
  <figcaption>Example custom pop-up dialog (AppleScript) for choosing a browser. The Finicky handler runs this script, captures the result, and opens the link in the chosen browser.</figcaption>
</figure>

<hr />
<h2>what I followed</h2>
<h3>1. <strong>install finicky</strong></h3>
<pre class="codehilite"><code class="language-bash">brew install --cask finicky
</code></pre>

<p>Then run it once manually to grant permissions(launch at login and default browser to intecept links and route them).</p>
<h3>2. <strong>write the <code>popup.sh</code></strong></h3>
<p>Create a script at <code>~/.config/kawaii/popup.sh</code>:</p>
<pre class="codehilite"><code class="language-bash">#!/bin/bash

# osascript to prompt for browser &amp; profile
CHOICE=$(osascript &lt;&lt;EOD
set browsers to {&quot;Safari&quot;, &quot;Chrome&quot;, &quot;Firefox&quot;, &quot;DuckDuckGo&quot;}
set browserChoice to choose from list browsers with prompt &quot;Choose your browser&quot; without multiple selections allowed
if browserChoice is false then
  return &quot;Safari&quot;
end if

set profiles to {&quot;Personal&quot;, &quot;Work&quot;}
set profileChoice to choose from list profiles with prompt &quot;Choose profile for &quot; &amp; item 1 of browserChoice without multiple selections allowed
if profileChoice is false then
  return item 1 of browserChoice
end if

return (item 1 of browserChoice) &amp; &quot; - &quot; &amp; (item 1 of profileChoice)
EOD
)

echo &quot;$CHOICE&quot;
</code></pre>

<p>Make it executable:</p>
<pre class="codehilite"><code class="language-bash">chmod +x ~/.config/kawaii/popup.sh
</code></pre>

<h3>3. <strong>create <code>finicky.js</code></strong></h3>
<pre class="codehilite"><code class="language-js">// ~/.finicky.js
export default {
  defaultBrowser: &quot;Safari&quot;,
  asyncBrowser: async (url) =&gt; {
    const result = await finicky.run({
      command: &quot;~/.config/kawaii/popup.sh&quot;
    })

    const choice = result.stdout.trim()

    switch (choice) {
      case &quot;Chrome - Personal&quot;:
        return { name: &quot;Google Chrome&quot;, profile: &quot;Gaurav&quot; }
      case &quot;Chrome - Work&quot;:
        return { name: &quot;Google Chrome&quot;, profile: &quot;spencer&quot; }
      case &quot;Firefox - Personal&quot;:
        return { name: &quot;Firefox&quot;, profile: &quot;personal&quot; }
      case &quot;Firefox - Work&quot;:
        return { name: &quot;Firefox&quot;, profile: &quot;work&quot; }
      case &quot;DuckDuckGo - Personal&quot;:
        return { name: &quot;DuckDuckGo&quot;, profile: &quot;personal&quot; }
      case &quot;DuckDuckGo - Work&quot;:
        return { name: &quot;DuckDuckGo&quot;, profile: &quot;work&quot; }
      case &quot;Safari&quot;:
      default:
        return &quot;Safari&quot;
    }
  }
}
</code></pre>

<p>In this setup, whenever Finicky intercepts a link, it runs the async browser function. The function calls our popup script via execSync, reads the chosen name, and returns it in an object <code>{name: "...", profile: "..."}</code> if needed. Finicky then launches that browser (and profile). If the user cancels, we return null to let Finicky use the default or do nothing. (Since Finicky v4, the browser function can be async and use modern syntax. We avoid any old legacy callbacks).</p>
<hr />
<h2>some walls i hit</h2>
<ul>
<li>
<p><strong>Validation error: <code>defaultBrowser</code> missing</strong><br />
    This must be set explicitly, even if you're overriding with <code>asyncBrowser</code>.</p>
</li>
<li>
<p><strong>No chooseBrowser API</strong> 
    Any mention of a built-in chooseBrowser is outdated. Finicky no longer provides a GUI chooser; we handle it ourselves via AppleScript.</p>
</li>
</ul>
<blockquote>
<p>Pro Tip: For more advanced UI, you can build your picker using tools like Raycast, Hammerspoon, or SwiftUI.</p>
</blockquote>
<hr />
<h2>orz</h2>
<ul>
<li><a href="https://github.com/johnste/finicky">Finicky GitHub Repo</a></li>
<li><a href="https://github.com/koekeishiya/yabai">Yabai</a></li>
</ul>

  <!-- Perlin noise image row (only for the perlin-noise post) -->
  
  </div>
  <div class="til-date">Posted on 29 July 2025 (IST) · Follow me on <a href="https://x.com/wiredguys">Twitter</a> or <a rel="me" href="https://mastodon.social/@wiredguy">Mastodon</a></div>

<div id="turnstile-container">
  <div id="cf-turnstile" class="cf-turnstile" data-sitekey="0x4AAAAAABiDRLV2JxUJ_Qv6"></div>
</div>
  <ul class="til-list">
    <li><a href="../../index.html">← TIL</a></li>
  </ul>
  <div class="til-sidebar">
    <h5>Jump to</h5>
    <ul>
      <li><a href="../rss-feed/">← Previous: Subscribe via RSS</a></li>
    </ul>
  </div>
  <script>
    // --- Upvote logic ---
    const slug = "{slug}";
    const upvoteBtn = document.getElementById('upvote-btn');
    const shareBtn = document.getElementById('share-btn');
    const turnstileContainer = document.getElementById('turnstile-container');
    const sessionKey = 'cf_upvote_verified';
    const upvotedKey = 'til_upvoted_' + slug;
    function isSessionVerified() {{
      return localStorage.getItem(sessionKey) === '1';
    }}
    function setSessionVerified() {{
      localStorage.setItem(sessionKey, '1');
    }}
    function isUpvoted() {{
      return localStorage.getItem(upvotedKey) === '1';
    }}
    function setUpvoted() {{
      localStorage.setItem(upvotedKey, '1');
      upvoteBtn.classList.add('upvoted');
      upvoteBtn.setAttribute('aria-pressed', 'true');
      // Animate arrow fill and pop
      const svg = upvoteBtn.querySelector('.upvote-arrow');
      if (svg) {{
        svg.setAttribute('fill', '#4b4e50');
        svg.setAttribute('stroke', '#4b4e50');
      }}
      upvoteBtn.classList.add('pop');
      setTimeout(() => upvoteBtn.classList.remove('pop'), 180);
    }}
    function resetUpvoteBtn() {{
      upvoteBtn.classList.remove('upvoted');
      upvoteBtn.setAttribute('aria-pressed', 'false');
      const svg = upvoteBtn.querySelector('.upvote-arrow');
      if (svg) {{
        svg.setAttribute('fill', '#d1d1d1');
        svg.setAttribute('stroke', '#7d8082');
      }}
    }}
    if (isUpvoted()) {{
      setUpvoted();
      upvoteBtn.disabled = true;
    }} else {{
      resetUpvoteBtn();
      upvoteBtn.disabled = false;
    }}
    upvoteBtn.addEventListener('click', function() {{
      if (isUpvoted()) return;
      // Animate pop even before upvote completes
      upvoteBtn.classList.add('pop');
      setTimeout(() => upvoteBtn.classList.remove('pop'), 180);
      if (isSessionVerified()) {{
        sendUpvote();
      }} else {{
        turnstileContainer.style.display = 'block';
      }}
    }});
    shareBtn.addEventListener('click', function() {{
      if (navigator.share) {{
        navigator.share({{
          title: document.title,
          url: window.location.href
        }});
      }} else {{
        navigator.clipboard.writeText(window.location.href);
        shareBtn.classList.add('shared');
        shareBtn.title = 'Copied!';
        setTimeout(() => {{ shareBtn.classList.remove('shared'); shareBtn.title = 'Share this TIL'; }}, 1200);
      }}
    }});
    window.turnstileCallback = function(token) {
      // POST to backend for verification and upvote
      fetch('/api/upvote', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({slug: slug, token: token})
      }).then(r => r.json()).then(data => {
        if (data.success) {
          setSessionVerified();
          setUpvoted();
          upvoteBtn.disabled = true;
          // Fire Cloudflare Analytics event
          if (window.cfAnalytics && window.cfAnalytics.trackEvent) {
            window.cfAnalytics.trackEvent('upvote', {slug: slug, type: 'til'});
          }
        } else {
          alert('Verification failed.');
        }
        turnstileContainer.style.display = 'none';
      });
    }
    function sendUpvote() {
      fetch('/api/upvote', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({slug: slug})
      }).then r => r.json()).then(data => {
        if (data.success) {
          setUpvoted();
          upvoteBtn.disabled = true;
          if (window.cfAnalytics && window.cfAnalytics.trackEvent) {
            window.cfAnalytics.trackEvent('upvote', {slug: slug, type: 'til'});
          }
        } else {
          alert('Upvote failed.');
        }
      });
    }
    // Cloudflare Turnstile callback
    window.onloadTurnstile = function() {
      if (window.turnstile) {
        window.turnstile.render('#cf-turnstile', {
          sitekey: '0x4AAAAAABiDRLV2JxUJ_Qv6',
          callback: window.turnstileCallback
        });
      }
    }
    // Listen for Turnstile ready
    document.addEventListener('DOMContentLoaded', function() {
      if (window.turnstile) window.onloadTurnstile();
    });
  </script>
</main>
</body>
</html>
